<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Ravescore — immersive visual experiences and digital content studio." />
  <title>Ravescore - Visual Experience Studio</title>
  <link rel="icon" type="image/x-icon" href="1000020118.jpg">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN (fine for prototypes) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Smooth scrolling */
    html { scroll-behavior: smooth; }
    section { scroll-margin-top: 100px; }
    body { font-family: 'Montserrat', sans-serif; margin:0; min-height:100vh; background:black; color:white; }
    .title-font { font-family: 'Bebas Neue', cursive; letter-spacing: .02em; }
    #vanta-bg { position: fixed; inset: 0; z-index: 0; pointer-events: none; width: 100%; height: 100vh; }
    .site-content { position: relative; z-index: 10; }
    .warning-box { background: rgba(220, 38, 38, 0.95); }

    /* Intro animations */
    @keyframes burstLogo {
      0% { transform: scale(0.9); opacity: 0; filter: brightness(0.5); }
      25% { transform: scale(1.05); opacity: 1; filter: brightness(1.5); }
      50% { transform: scale(1); filter: brightness(1); }
      75% { transform: scale(1.1); filter: brightness(2); }
      100% { transform: scale(1); opacity: 0; }
    }
    .animate-burst-logo { animation: burstLogo 2.8s ease-in-out forwards; }

    @keyframes pulseSlow {
      0%,100%{opacity:0.3;transform:scale(1);}
      50%{opacity:0.7;transform:scale(1.3);}
    }
    .animate-pulse-slow{animation:pulseSlow 1.8s ease-in-out infinite;}

    #intro-screen { transition: opacity 0.8s ease; }

    /* Music / radio controls */
    .radio-button {
      position: fixed;
      right: 92px; /* sits to the left of the control button (which is at right:18px) */
      bottom: 18px;
      z-index: 99999;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      color: #fff;
      padding: 8px 12px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
    }
    .radio-button:hover {
      transform: translateY(-4px);
      background: rgba(255,43,109,0.08);
      box-shadow: 0 8px 30px rgba(255,43,109,0.06);
    }

    .control-button {
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 99999;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      color: #fff;
      padding: 8px 12px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
      display: none; /* shown after intro */
    }
    .control-button:hover {
      transform: translateY(-4px);
      background: rgba(255,43,109,0.12);
      box-shadow: 0 10px 34px rgba(255,43,109,0.08);
      color: #fff;
    }
    .control-button:focus { outline: 2px solid rgba(255,43,109,0.18); outline-offset: 3px; }

    .music-resume-center {
      position: fixed;
      left: 50%;
      bottom: 22%;
      transform: translateX(-50%);
      z-index: 99999;
      display: none;
      background: #ff2b6d;
      color: white;
      padding: 14px 22px;
      border-radius: 999px;
      font-weight: 700;
      box-shadow: 0 8px 30px rgba(255,43,109,0.15);
      cursor: pointer;
    }
    .music-resume-center:hover { transform: translateX(-50%) translateY(-3px); }

    /* Radio drawer (bottom-right) */
    .radio-drawer {
      position: fixed;
      right: 18px;
      bottom: 64px;
      z-index: 99999;
      width: 320px;
      max-width: calc(100% - 36px);
      background: rgba(10,10,10,0.95);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
      display: none;
      color: #fff;
      font-size: 13px;
      backdrop-filter: blur(6px);
    }
    .radio-drawer h4 {
      margin: 0 0 8px 0;
      font-weight:700;
      font-family: 'Bebas Neue', cursive;
      color: #ff2b6d;
      font-size: 18px;
    }
    .radio-item { padding: 8px; border-radius:8px; display:flex; gap:8px; align-items:center; }
    .radio-item + .radio-item { margin-top:6px; }
    .radio-item .title { font-weight:700; font-size:16px; }
    .radio-item .meta { font-size:13px; opacity:0.8; }
    .radio-current { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.025); }

    @media (max-width:420px){
      .radio-drawer { width: calc(100% - 36px); right:18px; left:18px; }
      .radio-button { right: 18px; bottom: 18px; } /* fallback on tiny screens */
      .control-button { right: 18px; bottom: 56px; } /* avoid overlap */
    }

    /* ==== ADMIN GEAR + PANEL (bottom-left) ==== */
    .admin-gear {
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 100000;
      width: 46px;
      height: 46px;
      border-radius: 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform .12s ease, background .12s ease;
      backdrop-filter: blur(4px);
    }
    .admin-gear:hover { transform: translateY(-4px); background: rgba(255,43,109,0.06); box-shadow: 0 10px 30px rgba(255,43,109,0.06); }

    .admin-panel {
      position: fixed;
      left: 18px;
      bottom: 70px;
      z-index: 100001;
      min-width: 260px;
      max-width: calc(100% - 36px);
      background: rgba(11,11,11,0.98);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
      display: none;
      color: #fff;
      font-size: 14px;
      backdrop-filter: blur(6px);
    }
    .admin-panel h4 { margin: 0 0 6px 0; font-family: 'Bebas Neue', cursive; color: #ff2b6d; font-size: 16px; }
    .admin-input { width:100%; padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06); background:#0b0b0b;color:#fff;margin-bottom:8px; }
    .admin-btn { width:100%; padding:8px;border-radius:8px;border:none;background:#ff2b6d;color:#fff;font-weight:700; cursor:pointer; }
    .admin-secondary { width:100%; padding:8px;border-radius:8px;border:none;background:#333;color:#fff;margin-top:8px; cursor:pointer; }

    /* Maintenance overlay (global) */
    #global-maintenance-overlay {
      display:none;
      position: fixed;
      inset: 0;
      z-index: 999998;
      background: rgba(0,0,0,0.96);
      color: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 24px;
      flex-direction: column;
      gap: 12px;
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(18px, 3.2vw, 36px);
    }
    #global-maintenance-overlay p { margin:0; opacity:0.95; }

    /* tiny visually-hidden utility for accessible aria updates */
    .sr-only { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body class="bg-black text-white">

  <!-- ✨ RAVESCORE INTRO ANIMATION ✨ -->
  <div id="intro-screen" class="fixed inset-0 bg-black flex flex-col items-center justify-center z-[9999] overflow-hidden text-center" role="dialog" aria-modal="true" aria-label="Intro - Start experience">
    <div class="relative flex flex-col items-center justify-center space-y-6">
      <!-- Red glowing background circle -->
      <div class="absolute inset-0 rounded-full bg-red-600 blur-3xl opacity-30 animate-pulse-slow"></div>

      <!-- Logo -->
      <img id="intro-logo" src="1000020118.jpg" alt="Ravescore Logo" class="h-40 w-auto rounded-xl relative z-10 shadow-lg">

      <!-- Loading text -->
      <p id="intro-text" class="text-2xl md:text-4xl font-bold text-white opacity-90 mt-8 tracking-wide animate-pulse relative z-10">
        Loading the best website!
      </p>

      <!-- Start Experience Button -->
      <button id="start-experience-btn" class="relative z-10 mt-6 px-6 py-3 rounded-full bg-red-600 text-white font-bold hover:bg-red-700 transition transform hover:scale-105 focus:outline focus:outline-2">
        Start Experience
      </button>
    </div>
  </div>

  <!-- Vanta canvas container -->
  <div id="vanta-bg" aria-hidden="true"></div>

  <div class="site-content flex flex-col min-h-screen">

    <!-- Header -->
    <header class="container mx-auto px-4 py-8 flex justify-between items-center fixed w-full top-0 bg-black z-0">
      <div class="flex items-center space-x-10">
        <img src="1000020118.jpg" alt="Ravescore logo" class="h-12 w-auto rounded-md shadow-lg">
        <h1 class="title-font text-3xl tracking-wide">RAVESCORE</h1>
      </div>
      <nav aria-label="Primary">
        <ul class="flex space-x-6">
          <li><a href="#work" class="hover:text-red-500 transition focus:outline focus:outline-2 focus:outline-offset-2">Work</a></li>
          <li><a href="#about" class="hover:text-red-500 transition focus:outline focus:outline-2 focus:outline-offset-2">About</a></li>
          <li><a href="#contact" class="hover:text-red-500 transition focus:outline focus:outline-2 focus:outline-offset-2">Contact</a></li>
        </ul>
      </nav>
    </header>

    <main class="flex-grow flex items-center justify-center px-4 pt-32">
      <div class="text-center max-w-4xl mx-auto">
        <div class="warning-box animate-pulse text-white px-6 py-4 rounded-lg mb-8 inline-block">
          <div class="flex items-center justify-center space-x-2">
            <span data-feather="alert-triangle" class="w-6 h-6" aria-hidden="true"></span>
            <span class="font-bold">PHOTOSENSITIVITY WARNING</span>
          </div>
          <p class="mt-2 text-sm max-w-md mx-auto">
            This experience may contain flashing lights and rapidly changing images.
            Viewer discretion is advised for your comfort and safety.
          </p>
        </div>
        <h2 class="title-font text-5xl md:text-7xl mb-6">IMMERSIVE VISUAL EXPERIENCES</h2>
        <p class="text-xl mb-8 opacity-90">
          We craft boundary-pushing digital content that captivates and engages audiences worldwide.
        </p>
        <div class="flex justify-center space-x-4">
          <a href="#work">
            <button class="bg-white text-black px-8 py-3 rounded-full font-bold hover:bg-gray-200 transition transform hover:scale-105 focus:outline focus:outline-2">
              Explore Our Work
            </button>
          </a>
          <a href="#contact">
            <button class="border-2 border-white px-8 py-3 rounded-full font-bold hover:bg-white hover:text-black transition transform hover:scale-105 focus:outline focus:outline-2">
              Get In Touch
            </button>
          </a>
        </div>
      </div>
    </main>

    <!-- Work Section -->
    <section id="work" class="py-16 bg-black text-white">
      <h3 class="title-font text-3xl md:text-5xl mb-10 text-center">Featured Work</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto px-4">
        <!-- Project 1 -->
        <a href="project1.html" class="bg-gray-900 rounded-lg shadow-lg overflow-hidden group transform hover:scale-105 transition duration-300">
          <img src="1000020118.jpg" alt="Project 1" class="w-full h-48 object-cover group-hover:opacity-90 transition duration-300">
          <div class="p-6">
            <h4 class="font-bold text-xl mb-2">Project One</h4>
            <p class="opacity-80 mb-4">Coming soon!</p>
            <span class="text-red-500 font-semibold group-hover:underline">View Details →</span>
          </div>
        </a>

        <!-- Project 2 -->
        <a href="project2.html" class="bg-gray-900 rounded-lg shadow-lg overflow-hidden group transform hover:scale-105 transition duration-300">
          <img src="1000020118.jpg" alt="Project 2" class="w-full h-48 object-cover group-hover:opacity-90 transition duration-300">
          <div class="p-6">
            <h4 class="font-bold text-xl mb-2">Project Two</h4>
            <p class="opacity-80 mb-4">Coming soon!</p>
            <span class="text-red-500 font-semibold group-hover:underline">View Details →</span>
          </div>
        </a>

      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-16 bg-black text-white border-t border-gray-800">
      <div class="max-w-3xl mx-auto px-4 text-center">
        <h3 class="title-font text-3xl md:text-5xl mb-6">About Ravescore</h3>
        <p class="text-lg opacity-80 mb-4">
          Ravescore is an independent studio specializing in immersive visual experiences and digital content. Our multi-disciplinary team works hard to create impactful work for audiences worldwide.
        </p>
        <p class="opacity-60 mb-6">
          From live events and installations, we push boundaries and redefine what's possible. Driven by curiosity and collaboration, we turn ideas into captivating realities.
        </p>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-16 bg-black text-white border-t border-gray-800">
      <div class="max-w-xl mx-auto px-4">
        <h3 class="title-font text-3xl md:text-5xl mb-6 text-center">Contact Us</h3>

        <div id="contact-success" class="hidden mb-4 rounded-md p-3 text-green-900 bg-green-100" role="status" aria-live="polite"></div>
        <div id="contact-error" class="hidden mb-4 rounded-md p-3 text-red-900 bg-red-100" role="alert" aria-live="assertive"></div>

        <form id="contact-form-mailto" class="space-y-6" novalidate>
          <div>
            <label for="name" class="block text-left mb-1 font-semibold">Name</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              placeholder="Your name"
              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline focus:outline-2 focus:outline-red-600"
            >
          </div>

          <div>
            <label for="email" class="block text-left mb-1 font-semibold">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="Your email"
              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline focus:outline-2 focus:outline-red-600"
            >
          </div>

          <div>
            <label for="message" class="block text-left mb-1 font-semibold">Message</label>
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              placeholder="Your message"
              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline focus:outline-2 focus:outline-red-600"
            ></textarea>
          </div>

          <button id="contact-submit-mailto" type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-full transition w-full">
            Send Message
          </button>
        </form>

        <p class="mt-6 text-center opacity-60">
          Or email us at
          <a id="plain-mail-link" href="mailto:cookies.development1@gmail.com" class="text-red-400 hover:underline">cookies.development1@gmail.com</a>
        </p>

        <!-- Manual fallback UI -->
        <div id="manual-fallback" class="mt-4 text-center hidden">
          <p class="mb-2 text-sm opacity-70">If your mail client didn't open, you can:</p>
          <a id="manual-mailto-link" class="inline-block mb-2 text-red-400 hover:underline" href="#" target="_blank" rel="noopener">Click here to compose manually</a>
          <div>
            <button id="copy-msg-btn" class="text-sm px-3 py-2 border border-gray-700 rounded-md hover:bg-gray-800">Copy message to clipboard</button>
          </div>
        </div>
      </div>
    </section>

    <footer class="container mx-auto px-4 py-6 text-center opacity-75 text-sm">
      <p>© 2025 Ravescore. All rights reserved.</p>
    </footer>
  </div>

  <!-- Radio & Music UI -->
  <button id="radio-button" class="radio-button" aria-expanded="false" aria-controls="radio-drawer">Radio</button>

  <div id="radio-drawer" class="radio-drawer" aria-hidden="true" role="region" aria-label="Upcoming tracks">
    <h4>Upcoming</h4>
    <div id="now-playing-time" class="meta" style="margin-bottom:8px; font-weight:600;" role="status" aria-live="polite">00:00</div>
    <div id="radio-list" aria-live="polite" aria-atomic="true">
      <!-- JS will populate: first item = Now Playing, others = Upcoming -->
    </div>
  </div>

  <!-- Single control button (Pause / Resume toggle) -->
  <button id="music-toggle" class="control-button" aria-pressed="false" aria-hidden="true">Resume</button>

  <!-- small fallback center resume -->
  <button id="music-resume-center" class="music-resume-center" aria-hidden="true">Resume</button>

  <!-- Admin gear + panel (bottom-left) -->
  <div id="admin-gear" class="admin-gear" title="Admin" aria-haspopup="dialog" aria-controls="admin-panel">
    <!-- simple gear SVG -->
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09c.7 0 1.24-.36 1.51-1a1.65 1.65 0 0 0-.33-1.82L3.31 4.46A2 2 0 0 1 6.14 1.63l.06.06c.5.5 1.14.78 1.82.78.37 0 .73-.09 1.05-.26.28-.14.6-.22.92-.22H9a2 2 0 0 1 4 0h-.09c.32 0 .64.08.92.22.32.17.68.26 1.05.26.68 0 1.32-.28 1.82-.78l.06-.06A2 2 0 0 1 20.69 4.46l-.06.06c-.5.5-.78 1.14-.78 1.82 0 .37.09.73.26 1.05.14.28.22.6.22.92V9c0 .8-.36 1.54-1 1.99z" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <div id="admin-panel" class="admin-panel" role="dialog" aria-hidden="true">
    <h4>Admin</h4>
    <input id="admin-password" class="admin-input" type="password" placeholder="Password" aria-label="Admin password">
    <button id="admin-login-btn" class="admin-btn">Unlock</button>
    <div id="admin-controls" style="display:none;margin-top:10px;">
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
        <div style="flex:1;font-weight:700;">Maintenance Mode</div>
        <button id="maintenance-toggle" class="admin-btn" style="width:110px;background:#444;">Toggle</button>
      </div>
      <div id="admin-status" style="opacity:0.85;font-size:13px;">Status: <span id="maintenance-status-text">Unknown</span></div>
      <button id="admin-lock" class="admin-secondary">Lock</button>
    </div>
  </div>

  <!-- Global maintenance overlay (shown to all users when Firestore says maintenance:true) -->
  <div id="global-maintenance-overlay" role="alert" aria-hidden="true">
    <p>🚧 SITE UNDER MAINTENANCE 🚧</p>
    <p style="font-size:16px;opacity:0.8;">We'll be back shortly — thanks for your patience.</p>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>

  <!-- Firebase (compat) - keep same approach, filled with your config -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    /*******************************
     * Small initial UI bootstraps
     *******************************/
    feather.replace();
    if (typeof VANTA !== 'undefined') {
      VANTA.WAVES({
        el: "#vanta-bg",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0x1a1a1a,
        shininess: 0.00,
        waveHeight: 20.00,
        waveSpeed: 0.25,
        zoom: 0.65
      });
    } else {
      console.warn('VANTA library not loaded.');
    }
  </script>

  <!-- CONTACT FORM MAILTO SCRIPT (unchanged) -->
  <script>
    (function () {
      const FORM_RECIPIENT = 'cookies.development1@gmail.com';
      const form = document.getElementById('contact-form-mailto');
      const submitBtn = document.getElementById('contact-submit-mailto');
      const successBox = document.getElementById('contact-success');
      const errorBox = document.getElementById('contact-error');
      const manualFallback = document.getElementById('manual-fallback');
      const manualMailtoLink = document.getElementById('manual-mailto-link');
      const copyBtn = document.getElementById('copy-msg-btn');

      function hideAll() {
        successBox.classList.add('hidden');
        errorBox.classList.add('hidden');
        manualFallback.classList.add('hidden');
      }

      function showError(text) {
        errorBox.textContent = text;
        errorBox.classList.remove('hidden');
      }

      function showSuccess(text) {
        successBox.textContent = text;
        successBox.classList.remove('hidden');
      }

      function buildMailto(name, email, message) {
        const subject = encodeURIComponent('Ravescore contact from ' + name);
        const bodyText = `Name: ${name}\nEmail: ${email}\n\n${message}`;
        const body = encodeURIComponent(bodyText);
        return {
          uri: `mailto:${FORM_RECIPIENT}?subject=${subject}&body=${body}`,
          plainBody: bodyText
        };
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        hideAll();

        const name = (form.name.value || '').trim();
        const email = (form.email.value || '').trim();
        const message = (form.message.value || '').trim();

        if (!name || !email || !message) {
          showError('Please fill in all fields.');
          return;
        }
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(email)) {
          showError('Please enter a valid email address.');
          return;
        }
        const { uri, plainBody } = buildMailto(name, email, message);
        const tempLink = document.createElement('a');
        tempLink.href = uri;
        tempLink.style.display = 'none';
        document.body.appendChild(tempLink);

        try {
          tempLink.click();
          document.body.removeChild(tempLink);

          showSuccess('Your email client should open now. Please review the message and press Send.');
          manualMailtoLink.href = uri;
          manualFallback.classList.remove('hidden');
          copyBtn.onclick = async function () {
            try {
              await navigator.clipboard.writeText(plainBody);
              showSuccess('Message copied to clipboard — paste it into your email client and send.');
            } catch (err) {
              showError('Unable to copy to clipboard. Please manually select and copy the message.');
            }
          };
        } catch (err) {
          document.body.removeChild(tempLink);
          showError('Unable to open your mail client automatically.');
          manualMailtoLink.href = uri;
          manualFallback.classList.remove('hidden');
        }
      });
    })();
  </script>

  <!-- UPDATE POPUP (unchanged) -->
  <script>
    (function () {
      const SITE_VERSION = '2.0.0';
      const VERSION_KEY = 'ravescore_version_seen';
      let seenVersion = null;
      try {
        seenVersion = localStorage.getItem(VERSION_KEY);
      } catch (e) {
        console.warn('localStorage unavailable:', e);
      }
      if (seenVersion === SITE_VERSION) return;

      const style = document.createElement('style');
      style.textContent = `
        #rs-update-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:99999;display:flex;align-items:center;justify-content:center}
        #rs-update-card{background:#0b0b0b;color:#fff;padding:28px;border-radius:16px;max-width:520px;width:calc(100% - 40px);box-shadow:0 20px 60px rgba(0,0,0,.6);border:1px solid rgba(255,255,255,0.04);position:relative;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
        #rs-update-card .rs-title{font-family:'Bebas Neue',cursive;font-size:28px;color:#ff2b6d;margin:0 0 6px}
        #rs-update-card .rs-sub{opacity:.8;margin-bottom:12px}
        #rs-update-card .rs-body{background:#111;padding:12px;border-radius:8px;margin-bottom:12px;font-size:14px;opacity:.95}
        #rs-update-close{position:absolute;top:10px;right:12px;background:transparent;border:0;color:#ccc;font-size:22px;cursor:pointer;padding:6px;border-radius:6px}
        #rs-update-close:hover{color:#ff6b97}
        #rs-update-card ul{margin:6px 0 0 18px;padding:0}
        #rs-update-card p.rs-foot{font-size:12px;opacity:.7;margin:0}
      `;
      document.head.appendChild(style);

      const overlay = document.createElement('div');
      overlay.id = 'rs-update-overlay';
      overlay.setAttribute('role', 'dialog');
      overlay.setAttribute('aria-modal', 'true');
      overlay.setAttribute('aria-label', 'Ravescore Update Notification');

      const card = document.createElement('div');
      card.id = 'rs-update-card';
      card.innerHTML = `
        <button id="rs-update-close" aria-label="Close update notification">&times;</button>
        <h3 class="rs-title">Website Updated!</h3>
        <div class="rs-sub">Welcome to the latest version of <strong>Ravescore</strong>.</div>
        <div class="rs-body">
          <p style="margin:0 0 8px">What's new in <strong>${SITE_VERSION}</strong>:</p>
          <ul>
            <li>Improved visuals and animations</li>
            <li>Performance and load-time enhancements</li>
            <li>Small bug fixes and accessibility improvements</li>
          </ul>
        </div>
        <p class="rs-foot">You won't see this again until we release another update.</p>
      `;

      overlay.appendChild(card);
      document.body.appendChild(overlay);

      // Prevent background scroll while popup visible
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';

      const closeBtn = document.getElementById('rs-update-close');
      closeBtn.addEventListener('click', function () {
        try {
          localStorage.setItem(VERSION_KEY, SITE_VERSION);
        } catch (e) {
          console.warn('Could not write version to localStorage:', e);
        }
        if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
      });

      closeBtn.focus();
    })();
  </script>

  <!-- ========== MUSIC / RADIO SCRIPTS (GITHUB MP3s player + UI) ========== -->
  <script>
<<<<<<< HEAD
    /*****************************************************************************
     * MP3 player using files hosted in your GitHub repo (raw.githubusercontent.com)
     * Replaced YouTube logic with direct fetch -> blob -> Audio object URLs.
     * Keeps the same UI behavior: Start Experience must be clicked, fade, toggle.
     *****************************************************************************/

    // Playlist: filenames (exact names as in your repo root)
    const PLAYLIST = [
      { title: 'High On Life', artist: 'Martin Garrix', file: 'MartinGarrix_HighOnLife.mp3.mp3' },
      { title: 'Lost Without You', artist: 'Headhunterz', file: 'Headhunterz & Vertile ft. Sian Evans - Lost Without You (Defqon.1 2023 Closing Theme).mp3' }
    ];

    // Your GitHub raw base (username 'Ravescore' / repo 'Ravescore' / branch 'main')
    const GITHUB_BASE = "https://raw.githubusercontent.com/Ravescore/Ravescore/main/";

    // UI & state
    let currentIndex = 0;
    const CURRENT = () => PLAYLIST[currentIndex];

    // Audio elements (A/B) to allow seamless crossfade
    const audioA = document.createElement('audio');
    const audioB = document.createElement('audio');
    [audioA, audioB].forEach(a => { a.preload = 'auto'; a.crossOrigin = 'anonymous'; a.style.display='none'; document.body.appendChild(a); });

    let activePlayer = 'A'; // 'A' or 'B'
    function getActiveAudio(){ return activePlayer === 'A' ? audioA : audioB; }
    function getInactiveAudio(){ return activePlayer === 'A' ? audioB : audioA; }
    function flipActive(){ activePlayer = (activePlayer === 'A' ? 'B' : 'A'); }

    const FADE_TARGET_VOLUME = 0.5; // 0..1
    const INTRO_BURST_MS = 2800;
    const FADE_IN_MS = 2000;

    let musicPlaying = false;
    let userClickedStart = false;
    let elapsedInterval = null;

    // DOM refs
    const startBtn = document.getElementById('start-experience-btn');
    const musicToggle = document.getElementById('music-toggle');
    const radioButton = document.getElementById('radio-button');
    const radioDrawer = document.getElementById('radio-drawer');
    const centerResume = document.getElementById('music-resume-center');
=======
    // ======= Playlist: replace youtube entries with GitHub-hosted mp3s =======
    // Set this to your raw GitHub path (replace placeholders):
    const GITHUB_BASE = "https://raw.githubusercontent.com/YOUR_GITHUB_USERNAME/YOUR_REPO/main/";

    // File names (exact names in your repo). We will URL-encode them.
    const PLAYLIST = [
      {
        title: 'High On Life',
        artist: 'Martin Garrix',
        file: 'MartinGarrix_HighOnLife.mp3.mp3'
      },
      {
        title: 'Lost Without You',
        artist: 'Headhunterz',
        file: 'Headhunterz & Vertile ft. Sian Evans - Lost Without You (Defqon.1 2023 Closing Theme).mp3'
      }
    ];

    // computed full URLs
    PLAYLIST.forEach(p => { p.url = GITHUB_BASE + encodeURIComponent(p.file); });

    let currentIndex = 0; // index of currently playing in PLAYLIST
    const CURRENT = () => PLAYLIST[currentIndex];

    // Audio players (two for crossfade)
    const audioA = document.createElement('audio');
    const audioB = document.createElement('audio');
    audioA.preload = 'auto';
    audioB.preload = 'auto';
    audioA.crossOrigin = "anonymous";
    audioB.crossOrigin = "anonymous";
    // keep them visually hidden and out of layout
    audioA.style.display = 'none';
    audioB.style.display = 'none';
    document.body.appendChild(audioA);
    document.body.appendChild(audioB);

    // player state
    let activePlayer = 'A'; // 'A' or 'B' (which audio element currently audible)
    let musicPlaying = false; // logical audible state
    let userClickedStart = false;
    const INTRO_BURST_MS = 2800;
    const FADE_IN_MS = 2000;
    const FADE_TARGET_VOLUME = 0.5; // 0..1 (converted from earlier 0-100)
    const CROSSFADE_SECS = 5; // seconds to crossfade

    // helper to get DOM refs
    const startBtn = document.getElementById('start-experience-btn');
    const musicToggle = document.getElementById('music-toggle');
    const radioButton = document.getElementById('radio-button');
    const radioDrawer = document.getElementById('radio-drawer');
    const centerResume = document.getElementById('music-resume-center');

    // elapsed timer update
    let elapsedInterval = null;

    function populateRadioUI() {
      const list = document.getElementById('radio-list');
      if (!list) return;
      list.innerHTML = '';
      PLAYLIST.forEach((item, idx) => {
        const node = document.createElement('div');
        node.className = 'radio-item' + (idx === currentIndex ? ' radio-current' : '');
        node.innerHTML = `
          <div style="flex:1">
            <div class="title">${item.artist} — ${item.title}</div>
            <div class="meta">${idx === currentIndex ? 'Now playing' : 'Upcoming'}</div>
          </div>
        `;
        node.addEventListener('click', () => {
          // immediate jump to selected track with crossfade
          startTrackByIndex(idx);
        });
        list.appendChild(node);
      });

      // update screen-reader label for small element
      try {
        const nowLabel = document.getElementById('now-playing-time');
        if (nowLabel) nowLabel.setAttribute('aria-label', `Now playing: ${PLAYLIST[currentIndex].artist} ${PLAYLIST[currentIndex].title}`);
      } catch (e) {}
    }

    // get active / inactive audio elements
    function getActiveAudio() { return activePlayer === 'A' ? audioA : audioB; }
    function getInactiveAudio() { return activePlayer === 'A' ? audioB : audioA; }

    // Fade helper: targetVolume 0..1, duration ms
    function fadeAudioTo(audioEl, targetVol, duration = FADE_IN_MS) {
      try {
        if (!audioEl) return;
        targetVol = Math.max(0, Math.min(1, targetVol));
        // clear any existing fade interval on the element
        if (audioEl._fadeInterval) { clearInterval(audioEl._fadeInterval); audioEl._fadeInterval = null; }
        const start = Number(audioEl.volume) || 0;
        const steps = Math.max(1, Math.round(duration / 50));
        const diff = targetVol - start;
        let stepIndex = 0;
        audioEl._fadeInterval = setInterval(() => {
          stepIndex++;
          const next = start + (diff * (stepIndex / steps));
          audioEl.volume = Math.max(0, Math.min(1, next));
          if (stepIndex >= steps) {
            clearInterval(audioEl._fadeInterval);
            audioEl._fadeInterval = null;
            audioEl.volume = targetVol;
          }
        }, 50);
      } catch (e) { console.warn('fadeAudioTo error', e); }
    }

    // Global fadeTo to match old API (0-100 percent)
    function fadeTo(percent, duration = FADE_IN_MS) {
      const vol = Math.max(0, Math.min(100, percent)) / 100;
      // fade active audio to vol
      const a = getActiveAudio();
      fadeAudioTo(a, vol, duration);
    }

    // schedule crossfade when current audio is reaching end
    function attachScheduling(audioEl) {
      if (!audioEl) return;
      // ensure we don't double attach
      audioEl._schedulingAttached = true;
      const onTime = () => {
        if (!audioEl.duration || audioEl.duration === Infinity) return;
        const remaining = audioEl.duration - audioEl.currentTime;
        // schedule next when remaining <= CROSSFADE_SECS and haven't scheduled yet
        if (remaining <= CROSSFADE_SECS && !audioEl._nextScheduled) {
          audioEl._nextScheduled = true;
          const nextIndex = (currentIndex + 1) % PLAYLIST.length;
          startTrackByIndex(nextIndex, true); // crossfade into next
        }
      };
      audioEl.addEventListener('timeupdate', onTime);
      // cleanup flag on ended
      audioEl.addEventListener('ended', () => { audioEl._nextScheduled = false; });
    }

    // update elapsed display (MM:SS) - only when drawer visible
    function formatMMSS(sec) {
      const s = Math.floor(sec % 60);
      const m = Math.floor(sec / 60);
      return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }
    function updateElapsedDisplay() {
      const el = document.getElementById('now-playing-time');
      if (!el) return;
      try {
        const a = getActiveAudio();
        const now = a && typeof a.currentTime === 'number' ? a.currentTime : 0;
        el.textContent = formatMMSS(now || 0);
      } catch(e) {}
    }
    function startElapsedUpdater() {
      stopElapsedUpdater();
      elapsedInterval = setInterval(() => {
        const drawer = document.getElementById('radio-drawer');
        if (drawer && drawer.style.display !== 'none') updateElapsedDisplay();
      }, 500);
    }
    function stopElapsedUpdater() {
      if (elapsedInterval) { clearInterval(elapsedInterval); elapsedInterval = null; }
    }

    // start playing a track by index
    // if isAutoCrossfade === true -> called by scheduler, do a crossfade
    function startTrackByIndex(index, isAutoCrossfade=false) {
      index = index % PLAYLIST.length;
      const next = PLAYLIST[index];
      const active = getActiveAudio();
      const inactive = getInactiveAudio();

      // prepare inactive audio with next track
      inactive.src = next.url;
      inactive.load();
      inactive.volume = 0;
      inactive.preload = 'auto';

      // try to play inactive (user gesture needed if first play)
      const tryPlayInactive = async () => {
        try {
          await inactive.play();
        } catch (e) {
          // playback blocked until user gesture — show center resume etc.
          console.warn('playback blocked until gesture', e);
        }
      };
      tryPlayInactive();

      // if crossfading (either scheduled or forced), overlap volumes
      const crossfade = CROSSFADE_SECS * 1000;
      // Start crossfade immediately
      fadeAudioTo(active, 0, crossfade);
      fadeAudioTo(inactive, FADE_TARGET_VOLUME, crossfade);

      // after crossfade complete, pause old active and swap
      setTimeout(() => {
        try { active.pause(); active.currentTime = 0; } catch(e){}
        // switch active pointer
        activePlayer = (activePlayer === 'A') ? 'B' : 'A';
        musicPlaying = true;
        // update UI state
        musicToggle.textContent = 'Pause';
        musicToggle.setAttribute('aria-pressed', 'true');
        centerResume.style.display = 'none';
        centerResume.setAttribute('aria-hidden', 'true');
        musicToggle.style.display = 'block';
        musicToggle.setAttribute('aria-hidden', 'false');
        currentIndex = index;
        populateRadioUI();
        // attach scheduling to new active
        attachScheduling(getActiveAudio());
      }, crossfade + 80);

      // if not crossfade (force immediate switch) — we still used same crossfade logic above
    }

    // initial start without crossfade (first time)
    async function startFirstTrack() {
      const p = CURRENT();
      const a = getActiveAudio();
      a.src = p.url;
      a.preload = 'auto';
      a.volume = 0;
      try {
        await a.play();
        // fade volume in to target
        fadeAudioTo(a, FADE_TARGET_VOLUME, FADE_IN_MS);
        musicPlaying = true;
        musicToggle.textContent = 'Pause';
        musicToggle.setAttribute('aria-pressed', 'true');
        musicToggle.style.display = 'block';
        musicToggle.setAttribute('aria-hidden', 'false');
        populateRadioUI();
        attachScheduling(a);
      } catch (e) {
        console.warn('Autoplay blocked until gesture', e);
      }
    }
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b

    // --- Populate radio UI ---
    function populateRadioUI() {
      const list = document.getElementById('radio-list');
      if (!list) return;
      list.innerHTML = '';
      PLAYLIST.forEach((item, idx) => {
        const node = document.createElement('div');
        node.className = 'radio-item' + (idx === currentIndex ? ' radio-current' : '');
        node.setAttribute('role','button');
        node.setAttribute('tabindex','0');
        node.innerHTML = `
          <div style="flex:1">
            <div class="title">${item.artist} — ${item.title}</div>
            <div class="meta">${idx === currentIndex ? 'Now playing' : 'Upcoming'}</div>
          </div>
        `;
        node.addEventListener('click', () => startTrackByIndex(idx));
        node.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); startTrackByIndex(idx); }});
        list.appendChild(node);
      });

      try {
        const nowLabel = document.getElementById('now-playing-time');
        if (nowLabel) nowLabel.setAttribute('aria-label', `Now playing: ${PLAYLIST[currentIndex].artist} ${PLAYLIST[currentIndex].title}`);
      } catch (e) {}
    }
    populateRadioUI();

    // --- helpers: format time ---
    function formatMMSS(sec) {
      const s = Math.floor(sec % 60);
      const m = Math.floor(sec / 60);
      return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }

    // --- elapsed timer ---
    function updateElapsedDisplay() {
      const el = document.getElementById('now-playing-time');
      if (!el) return;
      try {
        const now = getActiveAudio().currentTime || 0;
        el.textContent = formatMMSS(now);
      } catch (e) {}
    }
    function startElapsedUpdater() {
      stopElapsedUpdater();
      elapsedInterval = setInterval(() => {
        if (radioDrawer && radioDrawer.style.display !== 'none') {
          updateElapsedDisplay();
        }
      }, 500);
    }
    function stopElapsedUpdater() {
      if (elapsedInterval) { clearInterval(elapsedInterval); elapsedInterval = null; }
    }

    // --- Fetch file -> blob -> objectURL (returns true/false) ---
    async function loadTrackIntoAudioByIndex(idx, audioEl) {
      const file = PLAYLIST[idx].file;
      const url = GITHUB_BASE + encodeURIComponent(file);
      try {
        const resp = await fetch(url, { mode: 'cors' });
        if (!resp.ok) throw new Error('Fetch failed: ' + resp.status);
        const blob = await resp.blob();
        // revoke previous if any
        if (audioEl._objectUrl) {
          try { URL.revokeObjectURL(audioEl._objectUrl); } catch(e) {}
          audioEl._objectUrl = null;
        }
        const objUrl = URL.createObjectURL(blob);
        audioEl._objectUrl = objUrl;
        audioEl.src = objUrl;
        return true;
      } catch (err) {
        console.warn('loadTrackIntoAudioByIndex error', err);
        return false;
      }
    }

    // --- fade helper for audio elements (targetVolume 0..1) ---
    function fadeTo(targetVolume, duration = FADE_IN_MS) {
      // fade active audio only
      const audio = getActiveAudio();
      if (!audio) return;
      if (audio._fadeInterval) clearInterval(audio._fadeInterval);
      const start = typeof audio.volume === 'number' ? audio.volume : 0;
      const steps = Math.max(1, Math.round(duration / 50));
      const diff = targetVolume - start;
      let i = 0;
      audio._fadeInterval = setInterval(() => {
        i++;
        audio.volume = Math.max(0, Math.min(1, start + diff * (i/steps)));
        if (i >= steps) {
          clearInterval(audio._fadeInterval);
          audio._fadeInterval = null;
          audio.volume = targetVolume;
        }
      }, 50);
    }

    // fade out and pause active audio
    function fadeOutAndPause(duration = 600) {
      const audio = getActiveAudio();
      if (!audio) return;
      if (audio._fadeInterval) clearInterval(audio._fadeInterval);
      const start = typeof audio.volume === 'number' ? audio.volume : 0;
      const steps = Math.max(1, Math.round(duration / 50));
      let i = 0;
      const diff = 0 - start;
      audio._fadeInterval = setInterval(() => {
        i++;
        audio.volume = Math.max(0, Math.min(1, start + diff * (i/steps)));
        if (i >= steps) {
          clearInterval(audio._fadeInterval);
          audio._fadeInterval = null;
          try { audio.pause(); } catch(e) {}
          audio.volume = 0;
        }
      }, 50);
    }

    // --- play given index (handles loading into inactive audio, crossfade) ---
    async function startTrackByIndex(idx) {
      if (idx < 0 || idx >= PLAYLIST.length) return;
      // if already playing the same track, just ensure UI
      if (idx === currentIndex && musicPlaying) {
        // already playing
        populateRadioUI();
        return;
      }

      // prepare inactive audio with requested track
      const inactive = getInactiveAudio();
      const success = await loadTrackIntoAudioByIndex(idx, inactive);
      if (!success) {
        console.warn('Failed to load track at index', idx);
        return;
      }

      // set start conditions
      inactive.volume = 0;
      inactive.currentTime = 0;

      try {
        // attempt to play inactive (this must be allowed by gesture in many cases)
        const playPromise = inactive.play();
        if (playPromise && typeof playPromise.then === 'function') {
          await playPromise.catch(err => { console.warn('play rejected', err); throw err; });
        }
      } catch (err) {
        // could be autoplay policy; show center resume fallback
        console.warn('Play failed, showing resume center', err);
        centerResume.style.display = 'block';
        centerResume.setAttribute('aria-hidden', 'false');
        musicToggle.style.display = 'none';
        musicToggle.setAttribute('aria-hidden', 'true');
        return;
      }

      // crossfade: fade inactive up, active down
      const fadeDuration = 1200;
      // fade up inactive to target
      const target = FADE_TARGET_VOLUME;
      (function crossfade() {
        // ensure active exists and fade down
        const active = getActiveAudio();
        if (active && !active.paused) {
          // fade active down and pause at end
          const startActive = active.volume || 0;
          const steps = Math.max(1, Math.round(fadeDuration / 50));
          let i = 0;
          if (active._fadeInterval) clearInterval(active._fadeInterval);
          active._fadeInterval = setInterval(() => {
            i++;
            active.volume = Math.max(0, startActive * (1 - i/steps));
            if (i >= steps) {
              clearInterval(active._fadeInterval);
              active._fadeInterval = null;
              try { active.pause(); } catch(e) {}
              active.volume = 0;
            }
          }, 50);
        }

        // fade inactive up
        const startInactive = inactive.volume || 0;
        let j = 0;
        if (inactive._fadeInterval) clearInterval(inactive._fadeInterval);
        inactive._fadeInterval = setInterval(() => {
          j++;
          inactive.volume = Math.max(0, Math.min(target, startInactive + (target - startInactive) * (j/Math.max(1,Math.round(fadeDuration/50)))));
          if (j >= Math.round(fadeDuration/50)) {
            clearInterval(inactive._fadeInterval);
            inactive._fadeInterval = null;
            inactive.volume = target;
          }
        }, 50);

        // swap active pointer
        flipActive();
        currentIndex = idx;
        populateRadioUI();
        musicPlaying = true;
        // show toggle
        musicToggle.style.display = 'block';
        musicToggle.setAttribute('aria-hidden','false');
        musicToggle.textContent = 'Pause';
        musicToggle.setAttribute('aria-pressed','true');

        // start elapsed timer if drawer open
        startElapsedUpdater();
      })();
    }

    // --- advance to next track on ended ---
    function attachEndedHandlers() {
      [audioA, audioB].forEach(a => {
        a.onended = () => {
          // advance index
          currentIndex = (currentIndex + 1) % PLAYLIST.length;
          // start next track by loading into inactive and crossfading
          startTrackByIndex(currentIndex).catch(e => console.warn('startTrackByIndex error', e));
        };
        a.onplay = () => {
          // ensure UI reflects playing
          musicPlaying = true;
          musicToggle.style.display = 'block';
          musicToggle.setAttribute('aria-hidden','false');
          musicToggle.textContent = 'Pause';
          musicToggle.setAttribute('aria-pressed','true');
        };
        a.onpause = () => {
          // UI will reflect pause when paused intentionally
        };
      });
    }
    attachEndedHandlers();

    // --- Start Experience click handler (user gesture required for playback) ---
    (function checkSessionIntro() {
      try {
        if (sessionStorage.getItem('ravescore_intro_seen') === 'true') {
          const intro = document.getElementById('intro-screen');
          if (intro && intro.parentNode) intro.parentNode.removeChild(intro);
<<<<<<< HEAD
=======
          // show music toggle control (but do not start audio automatically)
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
          musicToggle.style.display = 'block';
          musicToggle.setAttribute('aria-hidden', 'false');
        }
      } catch (e) {}
    })();

    startBtn.addEventListener('click', async function () {
      userClickedStart = true;
      try { sessionStorage.setItem('ravescore_intro_seen','true'); } catch(e){}
<<<<<<< HEAD

=======
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
      // animate logo burst
      const introLogo = document.getElementById('intro-logo');
      introLogo.classList.add('animate-burst-logo');

<<<<<<< HEAD
      // preload first track into inactive audio and attempt to play muted (gesture)
      try {
        const inactive = getInactiveAudio();
        await loadTrackIntoAudioByIndex(currentIndex, inactive);
        inactive.volume = 0;
        try {
          const p = inactive.play();
          if (p && typeof p.then === 'function') {
            await p.catch(err => { console.warn('play rejected at start', err); throw err; });
          }
          // fade in after intro
          setTimeout(()=>{ fadeTo(FADE_TARGET_VOLUME, FADE_IN_MS); }, 120);
          // mark playing and swap active
          flipActive();
          musicPlaying = true;
        } catch (err) {
          console.warn('Initial play attempt failed', err);
          // show resume center if autoplay still blocked
          centerResume.style.display = 'block';
          centerResume.setAttribute('aria-hidden','false');
        }
      } catch (err) {
        console.warn('Failed to preload first track', err);
      }

      // show single toggle control (visibility will be toggled if play failed)
      musicToggle.style.display = musicPlaying ? 'block' : musicToggle.style.display;
      musicToggle.setAttribute('aria-hidden', musicPlaying ? 'false' : 'true');
      musicToggle.textContent = musicPlaying ? 'Pause' : 'Resume';
      musicToggle.setAttribute('aria-pressed', musicPlaying ? 'true' : 'false');

      // restore scrolling unless update popup present
      if (!document.getElementById('rs-update-overlay')) {
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
      }
=======
      // keep intro for burst duration, then fade and reveal site
      setTimeout(() => {
        const intro = document.getElementById('intro-screen');
        if (intro) intro.style.opacity = '0';

        // start audio now (user gesture satisfied)
        startFirstTrack();
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b

      // remove intro after burst
      setTimeout(()=>{ const i = document.getElementById('intro-screen'); if (i && i.parentNode) i.parentNode.removeChild(i); }, 800);
      populateRadioUI();
    });

    // Toggle Pause/Resume
    musicToggle.addEventListener('click', function () {
<<<<<<< HEAD
      if (!getActiveAudio()) {
        musicPlaying = !musicPlaying;
        musicToggle.textContent = musicPlaying ? 'Pause' : 'Resume';
        musicToggle.setAttribute('aria-pressed', musicPlaying ? 'true' : 'false');
        return;
      }

      if (musicPlaying) {
        // fade out and pause
        fadeOutAndPause(600);
=======
      const a = getActiveAudio();
      const b = getInactiveAudio();
      if (!a) return;

      if (musicPlaying) {
        // fade out and pause
        fadeAudioTo(a, 0, 600);
        setTimeout(()=>{ try { a.pause(); b.pause(); } catch(e){} }, 650);
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
        musicPlaying = false;
        musicToggle.textContent = 'Resume';
        musicToggle.setAttribute('aria-pressed','false');
        centerResume.style.display = 'block';
        centerResume.setAttribute('aria-hidden','false');
      } else {
<<<<<<< HEAD
        // resume
        try {
          // play active audio
          const a = getActiveAudio();
          a.play().catch(err => console.warn('resume play rejected', err));
          setTimeout(()=>{ fadeTo(FADE_TARGET_VOLUME, 800); }, 80);
        } catch (e) { console.warn(e); }
=======
        // resume: play active and fade in
        try {
          a.play().catch(()=>{});
          fadeAudioTo(a, FADE_TARGET_VOLUME, 800);
        } catch(e){}
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
        musicPlaying = true;
        musicToggle.textContent = 'Pause';
        musicToggle.setAttribute('aria-pressed','true');
        centerResume.style.display = 'none';
        centerResume.setAttribute('aria-hidden','true');
      }
    });

    // center resume fallback
    centerResume.addEventListener('click', function () {
      const a = getActiveAudio();
      if (!a) return;
<<<<<<< HEAD
      a.play().catch(err => console.warn('center resume play rejected', err));
      setTimeout(()=>{ fadeTo(FADE_TARGET_VOLUME, 800); }, 80);
=======
      try { a.play(); } catch(e){ console.warn(e); }
      setTimeout(()=>{ fadeAudioTo(a, FADE_TARGET_VOLUME, 800); }, 80);
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
      musicPlaying = true;
      musicToggle.textContent = 'Pause';
      musicToggle.setAttribute('aria-pressed','true');
      centerResume.style.display = 'none';
      centerResume.setAttribute('aria-hidden','true');
      musicToggle.style.display = 'block';
      musicToggle.setAttribute('aria-hidden','false');
    });

    // Radio drawer toggle
    radioButton.addEventListener('click', function () {
      const expanded = radioButton.getAttribute('aria-expanded') === 'true';
      if (expanded) {
        radioDrawer.style.display = 'none';
        radioDrawer.setAttribute('aria-hidden', 'true');
        radioButton.setAttribute('aria-expanded', 'false');
        stopElapsedUpdater();
      } else {
        populateRadioUI();
        updateElapsedDisplay();
        radioDrawer.style.display = 'block';
        radioDrawer.setAttribute('aria-hidden', 'false');
        radioButton.setAttribute('aria-expanded', 'true');
        startElapsedUpdater();
      }
    });

    // ensure scrolling restored if intro already removed
    window.addEventListener('load', ()=> {
      if (!document.getElementById('intro-screen') && !document.getElementById('rs-update-overlay')) {
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
      }
    });

<<<<<<< HEAD
    // Expose startTrackByIndex globally for debugging if needed
    window.startTrackByIndex = startTrackByIndex;

    // initialize radio UI
    (function initRadioUI(){ populateRadioUI(); })();
=======
    // Ensure radio UI shows Now Playing initially
    (function initRadioUI(){ populateRadioUI(); })();

    // Expose small debug function (optional)
    window.__ravescore_audio_debug = { audioA, audioB, getActiveAudio, getInactiveAudio };
>>>>>>> 297780f1060b6ab06f215dfe2738d66e15ca4d3b
  </script>

  <!-- FIRESTORE ADMIN PANEL SCRIPT (keeps your original firebase config + logic) -->
  <script>
    // --- FIREBASE CONFIG: your provided values ---
    const firebaseConfig = {
      apiKey: "AIzaSyBZ9yZrwSKRJ8YKegX-bXoc480OEFe_0co",
      authDomain: "ravescoreadmin.firebaseapp.com",
      databaseURL: "https://ravescoreadmin-default-rtdb.firebaseio.com",
      projectId: "ravescoreadmin",
      storageBucket: "ravescoreadmin.firebasestorage.app",
      messagingSenderId: "952715717877",
      appId: "1:952715717877:web:e48dd4ee51e4dc7b9fe9bc",
      measurementId: "G-FHPW7N4BJV"
    };

    // Initialize Firebase app + Firestore (compat)
    try {
      if (!window.firebase || !window.firebase.apps || !window.firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      } else {
        // reuse existing
      }
    } catch (e) {
      console.warn('Firebase init error (maybe already initialized):', e);
    }
    const db = (typeof firebase !== 'undefined' && firebase.firestore) ? firebase.firestore() : null;

    // Admin UI elems
    const adminGear = document.getElementById('admin-gear');
    const adminPanel = document.getElementById('admin-panel');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminUnlockBtn = document.getElementById('admin-login-btn');
    const adminControls = document.getElementById('admin-controls');
    const maintenanceToggle = document.getElementById('maintenance-toggle');
    const maintenanceStatusText = document.getElementById('maintenance-status-text');
    const adminLockBtn = document.getElementById('admin-lock');
    const overlay = document.getElementById('global-maintenance-overlay');

    const ADMIN_PASSWORD = 'Cookie';

    // toggle admin panel visibility
    adminGear.addEventListener('click', () => {
      const shown = adminPanel.style.display === 'block';
      adminPanel.style.display = shown ? 'none' : 'block';
      if (!shown) {
        adminPanel.setAttribute('aria-hidden', 'false');
        adminPasswordInput.focus();
      } else {
        adminPanel.setAttribute('aria-hidden', 'true');
      }
    });

    // unlock
    adminUnlockBtn.addEventListener('click', async () => {
      const val = (adminPasswordInput.value || '').trim();
      if (val === ADMIN_PASSWORD) {
        adminControls.style.display = 'block';
        adminPasswordInput.value = '';
        adminPasswordInput.disabled = true;
        adminUnlockBtn.style.display = 'none';
        // show status
        fetchCurrentMaintenanceStatus();
      } else {
        alert('Wrong password');
      }
    });

    adminLockBtn.addEventListener('click', () => {
      adminControls.style.display = 'none';
      adminPasswordInput.disabled = false;
      adminUnlockBtn.style.display = 'block';
      adminPanel.style.display = 'none';
    });

    async function fetchCurrentMaintenanceStatus() {
      if (!db) {
        maintenanceStatusText.textContent = 'Firestore unavailable';
        return;
      }
      try {
        const docRef = db.collection('settings').doc('site');
        const doc = await docRef.get();
        const data = doc.exists ? doc.data() : null;
        const isMaintenance = data && data.maintenanceMode === true;
        maintenanceStatusText.textContent = isMaintenance ? 'ON' : 'OFF';
      } catch (e) {
        console.warn('fetchCurrentMaintenanceStatus', e);
        maintenanceStatusText.textContent = 'Error';
      }
    }

    // toggle maintenance in Firestore
    maintenanceToggle.addEventListener('click', async () => {
      if (!db) {
        alert('Firestore not configured. Please paste your firebase config in the script.');
        return;
      }
      try {
        const docRef = db.collection('settings').doc('site');
        const doc = await docRef.get();
        const current = doc.exists && doc.data() && doc.data().maintenanceMode === true;
        await docRef.set({ maintenanceMode: !current }, { merge: true });

        // optimistic UI
        maintenanceStatusText.textContent = !current ? 'ON' : 'OFF';

        // fade audio accordingly (0 = off, FADE_TARGET_VOLUME = on)
        if (!current) {
          try { fadeTo(0, 1200); } catch(e){}
        } else {
          try { if (musicPlaying) fadeTo(FADE_TARGET_VOLUME * 100, 1200); } catch(e){}
        }
      } catch (e) {
        console.warn('Toggle maintenance failed', e);
        alert('Failed to toggle maintenance. See console.');
      }
    });

    // Realtime listener: when Firestore value changes, show/hide overlay for all users
    if (db) {
      try {
        // Keep overlay hidden until snapshot yields a result to avoid flicker
        db.collection('settings').doc('site').onSnapshot((doc) => {
          const data = doc.exists ? doc.data() : null;
          const isMaintenance = data && data.maintenanceMode === true;

          if (isMaintenance) {
            overlay.style.display = 'flex';
            overlay.setAttribute('aria-hidden', 'false');
            // fade audio out
            try { fadeTo(0, 1000); } catch(e){}
          } else {
            overlay.style.display = 'none';
            overlay.setAttribute('aria-hidden', 'true');
            // fade audio back in if user previously started playback
            try { if (musicPlaying) fadeTo(FADE_TARGET_VOLUME * 100, 1000); } catch(e){}
          }

          // update admin UI status if panel visible
          maintenanceStatusText.textContent = isMaintenance ? 'ON' : 'OFF';
        }, (err) => {
          console.warn('Firestore snapshot listen failed', err);
        });
      } catch (e) {
        console.warn('Firestore snapshot listen failed', e);
      }
    }

    // Close admin panel if clicked outside
    document.addEventListener('click', (evt) => {
      if (!adminPanel.contains(evt.target) && !adminGear.contains(evt.target)) {
        adminPanel.style.display = 'none';
      }
    });
  </script>

</body>
</html>
